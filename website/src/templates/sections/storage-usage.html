<section class="card">
  <h2 data-lang="en">Storage Usage</h2>
  <h2 data-lang="cs">Využití úložiště</h2>

  <ul class="storage-list">

    {# HUB #}
    {% set d = disks.hub %}
    <li class="storage-item">
      <div class="storage-header">
        <span>Hub ({{ d.path }})</span>
        <span data-lang="en">
          {{ "%.1f"|format(d.used_gib) }} / {{ "%.1f"|format(d.total_gib) }} GiB
          ({{ "%.1f"|format(d.percent) }}% used)
        </span>
        <span data-lang="cs">
          {{ "%.1f"|format(d.used_gib) }} / {{ "%.1f"|format(d.total_gib) }} GiB
          (využito {{ "%.1f"|format(d.percent) }} %)
        </span>
      </div>
      <div class="storage-bar">
        <div class="storage-bar-fill" style="width: {{ d.percent }}%;"></div>
      </div>
      <p class="note">{{ d.note }}</p>
    </li>

    {# SAFETANK WITH ZFS STATUS #}
    {% set d = disks.safetank %}
    <li class="storage-item">
      <div class="storage-header">
        <span>Safetank ({{ d.path }})</span>
        <span data-lang="en">
          {{ "%.1f"|format(d.used_gib) }} / {{ "%.1f"|format(d.total_gib) }} GiB
          ({{ "%.1f"|format(d.percent) }}% used)
        </span>
        <span data-lang="cs">
          {{ "%.1f"|format(d.used_gib) }} / {{ "%.1f"|format(d.total_gib) }} GiB
          (využito {{ "%.1f"|format(d.percent) }} %)
        </span>
      </div>
      <div class="storage-bar">
        <div class="storage-bar-fill" style="width: {{ d.percent }}%;"></div>
      </div>
      <p class="note">{{ d.note }}</p>

    {% if d.zfs %}
      {# Overall state line #}
      <p class="note" data-lang="en">
        ZFS state:
        <strong class="{{ 'ok' if d.zfs.healthy else 'bad' }}">
          {{ d.zfs.state }}
        </strong>
      </p>
      <p class="note" data-lang="cs">
        Stav ZFS:
        <strong class="{{ 'ok' if d.zfs.healthy else 'bad' }}">
          {{ d.zfs.state }}
        </strong>
      </p>

      {# Optional: status / action summary #}
      {% if d.zfs.status %}
        <p class="note" data-lang="en">
          {{ d.zfs.status }}
        </p>
        <p class="note" data-lang="cs">
          {{ d.zfs.status }}
        </p>
      {% endif %}

      {% if d.zfs.action %}
        <p class="note" data-lang="en">
          Suggested action: {{ d.zfs.action }}
        </p>
        <p class="note" data-lang="cs">
          Doporučený postup: {{ d.zfs.action }}
        </p>
      {% endif %}

      {# Optional: scrub info #}
      {% if d.zfs.scrub %}
        <p class="note" data-lang="en">
          Last scrub: {{ d.zfs.scrub }}
        </p>
        <p class="note" data-lang="cs">
          Poslední scrub: {{ d.zfs.scrub }}
        </p>
      {% endif %}

      {# Per‑device problems #}
      {% if d.zfs.bad_devices %}
        <ul class="note">
          {% for dev in d.zfs.bad_devices %}
            <li data-lang="en">
              Device {{ dev.name }}: {{ dev.state }}
              (R {{ dev.read }}, W {{ dev.write }}, CKSUM {{ dev.cksum }})
            </li>
            <li data-lang="cs">
              Zařízení {{ dev.name }}: {{ dev.state }}
              (čtení {{ dev.read }}, zápis {{ dev.write }}, CKSUM {{ dev.cksum }})
            </li>
          {% endfor %}
        </ul>
      {% endif %}
    {% endif %}

    </li>

    {# FASTTANK WITH ZFS STATUS #}
    {% set d = disks.fasttank %}
    <li class="storage-item">
      <div class="storage-header">
        <span>Fasttank ({{ d.path }})</span>
        <span data-lang="en">
          {{ "%.1f"|format(d.used_gib) }} / {{ "%.1f"|format(d.total_gib) }} GiB
          ({{ "%.1f"|format(d.percent) }}% used)
        </span>
        <span data-lang="cs">
          {{ "%.1f"|format(d.used_gib) }} / {{ "%.1f"|format(d.total_gib) }} GiB
          (využito {{ "%.1f"|format(d.percent) }} %)
        </span>
      </div>
      <div class="storage-bar">
        <div class="storage-bar-fill" style="width: {{ d.percent }}%;"></div>
      </div>
      <p class="note">{{ d.note }}</p>

      {% if d.zfs %}
        <p class="note" data-lang="en">
          ZFS state: <strong>{{ d.zfs.state }}</strong>
        </p>
        <p class="note" data-lang="cs">
          Stav ZFS: <strong>{{ d.zfs.state }}</strong>
        </p>
      {% endif %}
    </li>

  </ul>
</section>
